# Информационный бот (InformationBot)

**Описание**

Информационный бот предоставляет пользователям актуальную информацию (прогноз погоды, новости и события) через Telegram. Пользователь может запрашивать данные по командам и подписываться на регулярные уведомления.

---

## Основные возможности

* **Автоматическая регистрация пользователей** по Telegram ID в базе данных
* **Обработка команд**:

  * `/start` — начало работы с ботом (автоматическая регистрация)
  * `/help` — справка по доступным командам
  * `/weather [город]` — получение текущего прогноза погоды
  * `/news` — получение последних новостей
  * `/events` — получение информации о предстоящих событиях
* **Полное логирование** всех команд пользователей в базе данных
* **Система миграций** Alembic для управления структурой БД
* **Подписка на регулярные уведомления** с настраиваемой частотой (в разработке)

---

## Архитектура проекта

1. **Telegram-бот** на Python с использованием библиотеки `pyTelegramBotAPI`.
2. **Серверная часть** на Python для интеграции с внешними API (погода, новости, события).
3. **База данных** SQLite с SQLAlchemy и Alembic для миграций.
4. **Система логирования** всех команд пользователей в базе данных.
5. **Планировщик задач** APScheduler для регулярного обновления данных и отправки подписных уведомлений.

---

## Модель данных

* **users**

  * `id` — внутренний идентификатор
  * `telegram_id` — Telegram ID пользователя
  * `name` — имя пользователя
  * `registered_at` — дата и время регистрации
  * `subscription_settings` — параметры подписки (тип и частота)

* **logs**

  * `id` — внутренний идентификатор лога
  * `user_id` — ссылка на пользователя
  * `command` — запрошенная команда или действие
  * `timestamp` — дата и время запроса

---

## Установка и настройка

1. **Клонировать репозиторий**:

   ```bash
   git clone https://github.com/ваш_пользователь/InformationBot.git
   cd InformationBot
   ```

2. **Создать виртуальное окружение и установить зависимости**:

   ```bash
   python3 -m venv venv
   source venv/bin/activate  # Linux/macOS
   venv\Scripts\activate     # Windows
   pip install -r requirements.txt
   ```

3. **Настроить переменные окружения** (создать файл `.env` в корне проекта):

   ```env
   TELEGRAM_BOT_TOKEN=ваш_токен_бота
   WEATHER_API_KEY=ключ_API_погоды
   NEWS_API_KEY=ключ_API_новостей
   DATABASE_URL=sqlite:///bot.db
   ```

4. **Инициализировать базу данных** (для Windows):

   ```powershell
   # Автоматическая настройка через PowerShell скрипт
   .\setup_database.ps1

   # Или выполнить команды вручную:
   alembic revision --autogenerate -m "Initial migration"
   alembic upgrade head
   python check_database.py
   ```

5. **Запустить бота**:

   ```bash
   python wether_news_bot.py
   ```

---

## Примеры использования

* Получить прогноз погоды:

  ```
  /weather Moscow
  ```

* Получить последние новости:

  ```
  /news
  ```

* Подписаться на ежедневные уведомления о событиях:

  ```
  /subscribe events daily
  ```

---

## Зависимости

Основные библиотеки:
* `pyTelegramBotAPI` — для работы с Telegram Bot API
* `sqlalchemy` — ORM для работы с базой данных
* `alembic` — система миграций для БД
* `python-dotenv` — загрузка переменных окружения
* `requests` — HTTP-запросы к внешним API

Полный список зависимостей в файле `requirements.txt`.

---

## Тестирование

* **Юнит-тесты** для модулей бота и серверной части
* **Интеграционные тесты** для проверки взаимодействия с внешними API
* **Тестирование планировщика** APScheduler

Запуск тестов:

```bash
pytest tests/
```

---

## Структура файлов

```
InformationBot/
├── alembic/                    # Миграции базы данных
│   ├── env.py                  # Конфигурация Alembic
│   ├── script.py.mako          # Шаблон миграций
│   └── versions/               # Файлы миграций
├── database/                   # Модуль базы данных
│   ├── __init__.py
│   ├── config.py               # Настройки подключения к БД
│   ├── models.py               # Модели SQLAlchemy
│   └── crud.py                 # Функции для работы с БД
├── wether_news_bot.py          # Основной файл бота
├── check_database.py           # Скрипт проверки БД
├── setup_database.ps1          # PowerShell скрипт настройки
├── requirements.txt             # Зависимости проекта
├── alembic.ini                 # Конфигурация Alembic
├── .env                        # Переменные окружения
└── bot.db                      # База данных SQLite (создается автоматически)
```

---

## Интеграция с базой данных

### Автоматическая регистрация пользователей
При команде `/start` пользователь автоматически регистрируется в базе данных с сохранением:
- Telegram ID
- Имени пользователя
- Даты и времени регистрации

### Логирование команд
Все команды пользователей логируются в таблицу `logs`:
- `/start` - регистрация пользователя
- `/help` - справка
- `/weather [город]` - запрос погоды
- `/news` - получение новостей
- `/events` - информация о событиях

### Проверка базы данных
Для просмотра данных в базе используйте:
```powershell
python check_database.py
```

### Управление миграциями
```powershell
# Создать новую миграцию
alembic revision --autogenerate -m "Описание изменений"

# Применить миграции
alembic upgrade head

# Откатить последнюю миграцию
alembic downgrade -1
```

---

## План разработки

Проект рассчитан на 14 дней:

1. **Этап 1 (Дни 1–3)**: анализ требований, настройка репозитория, проектирование архитектуры
2. **Этап 2 (Дни 4–8)**: реализация основных команд и интеграции с API
3. **Этап 3 (Дни 9–11)**: объединение компонентов, отладка, тестирование
4. **Этап 4 (Дни 12–14)**: финальная проверка, исправление ошибок, деплой

---

## Лицензия

Проект распространяется под MIT License.
